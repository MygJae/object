# 간략한 내용 정리

# 14 일관성 있는 협력
- 객체지향 설계의 목표는 적절한 책임을 수행하는 객체들의 협력을 기반으로 결합도가 낮고 재사용 가능한 코드 구조를 창조하는 것
- 유사한 기능을 구현하기 위해 유사한 협력 패턴을 사용하라

## 14-1 핸드폰 과금 시스템 변경하기
### 기본 정책 확장
- FixedFeePolicy(고정요금), TimeOfDayDiscountPolicy(시간대별), DayOfWeekDiscountPolicy(요일별), DurationDiscountPolicy(구간별)로 정책 확장

### 고정요금 방식 구현하기
- 기준 RegularPolicy를 FixedFeePolicy로 변경

### 시간대별 방식 구현하기
- 기간을 관리하는 DateTimeInterval 클래스 추가
    - 통화 기간을 일자별로 분리
    - 일자별로 분리된 기간을 다시 시간대별 규칙에 따라 분리한 후 각 기간에 대해 요금을 계산
- 시간대별로 분리하는 강접은 TimeOfDayDiscountPolicy가 담당함

### 요일별 방식 구현하기
- 요일별 방식을 구현하기 위한 DayOfWeekDiscountRule 클래스 추가

### 구간별 방식 구현하기
- 위의 방식들은 서로 구현이 달라 구간별 방식을 구현하기 위해서 새로운 구현을 추가해야 하며 이는 일관성 없는 설계로 이어짐
- 설계에 일관성이 없으므로 추후 개발자들이 유지보수하기 위해 어려움이 있을 수 있음
- 유사한 기능을 서로 다른 방식으로 구현해서는 안됨

## 14-2 설계에 일관성 부여하기
- 일관성 있는 설계를 만드는 데 가장 훌륭한 방법은 다양한 설계 경험을 익히는 것임
- 널리 알려진 디자인 패턴을 학습하고 변경이라는 문맥 안에서 디자인 패턴을 적용해 보는 것도 좋음

### 조건 로직 대 객체 탐색
- 절차지향 프로그래밍의 분기를 위해 조건 로직 사용하지만 객체지향 프로그래밍은 다형성을 이용하여 객체 탐색으로 대체할 수 있음
- 큰 메서드 안에 뭉쳐있던 조건 로직들을 변경의 압력에 맞춰 작은 클래스들로 분리하고 나면 인스턴스들 사이의 협력 패턴에 일관성을 부여하기 쉬워짐
- 일관성 있는 협력을 위한 지침
    - 변하는 개념을 변하지 않는 개념으로부터 분리하라
        - 일관성 있는 협력을 위한 타입 계층 구성 -> 클라이언트로부터 분리를 위핸 타입 계층에 역할을 도입 -> 역할을 추상 클래스와 인터페이스로 구현 -> 변하는 개념을 별도의 서브타입으로 분리 -> 서브타입들을 클라이언트로부터 캡슐화함
    - 변하는 개념을 캡슐화하라
        - 훌륭한 추상화를 찾아 추상화에 의존하도록 만듬

### 캡슐화 다시 살펴보기
- 캡슐화는 데이터 은닉(data hiding) 이상임
- 캡슐화란 단순히 데이터를 감추는 것이 아니라 소프트웨어 안에서 변할 수 있는 모든 개념을 감추는 것임
- 캡슐화란 변하는 어떤 것이든 감추는 것임
- 코드 수정으로 인한 파급효과를 제어할 수 있는 모든 기법
- 일반적으로 사용하는 일관성 있는 협력을 위한 서브타입 캡슐화(인터페이스)와 객채 캡슐화(합성)

## 14-3 일관성 있는 기본 정책 구현하기
### 변경 분리하기
- 기본 정책은 한 개 이상의 규칙으로 구성
- 하나의 규칙은 적용조건과 단위요금의 조합
- 규칙 = 변하지 않음, 적용조건 = 변함

### 변경 캡슐화하기
- 규칙으로부터 적용조건을 분리해서 추상화한 후 시간대별, 요일별, 구간별 방식으로 서브타입을 만듬 -> 서바타입 캡슐화 -> 규칙이 적용조건을 표현하는 추상화를 합성 관계로 연결 -> 객체 캡슐화

### 협력 패턴 설계하기
- 추상화된 부분들로 객체 사이의 협력을 구성함

### 추상화 수준에서 협력 패턴 구현하기
- 추상화된 객채들을 각각의 세분화된 클래스로 메서드를 구현함

### 구체적인 협력 구현하기
- 변하는 부분을 변하지 않는 부분으로부터 분리했기 때문에 변하지 않는 부분을 재사용할 수 있음
- 새로운 기능을 추가하기 위해 변하는 부분만 구현하면 됨
- 코드의 재사용성이 향상되고 테스트해야 하는 코드의 양이 감소하게 됨
- 기능을 추가할 떄 구조를 강제할 수 있어서 설계의 일관성을 지킬 수 있음
- 유사한 기능에 대해 유사한 협력 패턴을 적용하는 것은 개념적 무결성(Conceptual Integrity)을 유지하는 가장 효과적인 방법임

### 협력 패턴에 맞추기
- 고정요금 정책은 기존 협력 방식에서는 상식이 벗어나지만 최대한 기존의 협력 패턴에 맞추는 것이 가장 좋은 방법임
- 설계를 약간 비트는 것이 조금 이상한 구조를 낳더라도 전체적으로 일관성을 유지할 수 있는 설계를 선택하는 것이 현명함
- 새로운 요구사항에 의해 일관성이 조금씩 금이 가는 경우도 있으므로 지속적으로 개선해야 함

### 패턴을 찾아라
- 훌륭한 설계자가 되는 방법은 변경의 방향을 파악할 수 있는 날카로운 감각을 기르는 것임
- 유사한 기능에 대한 변경이 지속적으로 발생하면 변경을 캡슐화하는 적절한 추상화를 찾은 후 변하지 않는 공통적인 책임을 할당하라
- 변경을 캡슐화하기에 적합하지 않다면 코드를 수정하지 않고도 원하는 변경을 수용할 수 있또록 코드를 리팩터링해야 함
- 협력을 일관성 있게 만드는 과정은 유사한 기능을 구현하기 위해 반복적으로 적용할 수 있는 협력의 구조를 찾아가는 기나긴 여정임

# 읽고 느낀 점
- 이번 챕터는 코드에 대한 설명이 많았으며 책에서 말하는 변경을 파악할 수 있는 감을 잡는데 도움이 된것 같다
- 항상 변경에 대해 어떻게 해야하는지 많은 고민을 하지만 지금까지 일해왔던 곳들에서는 과연 변경이 있을까? 라는 의문점이 들었고 다른 곳도 생각보다 변경하며 확장할 일이 많을까? 라는 궁금증도 생겼다
- 나온 예제들을 보며 결국 이런 코드들도 영속성 관리하는 곳들에 저장하게 될텐데 그때에는 어떻게 바꿔야할까? 등 그 부분에 대한 예제까지 나중에 책으로 나왔으면 좋겠다는 생각도 했다